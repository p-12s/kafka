# Что такое Apache Kafka?
Apache Kafka – это распределенное, отказоустойчивое, горизонтально масштабируемое хранилище, основной структурой данных в котором является append-only лог и которое:
- поддерживает потоковую обработку данных;
- имеет развитую экосистему коннекторов для интеграции с базами данных и другими хранилищами.

## Зачем создали Apache Kafka?
Kafka разработали более 10 лет назад в LinkedIn из-за потребности компании в обработке огромных потоков данных между различными частями их внутренней платформы.  
Оценив существующие на тот момент решения, инженеры компании решили разработать свою технологию.  
Кстати, название технологии дал её автор – Jay Kreps, в честь любимого писателя Франца Кафки.

## Почему выбирают Apache Kafka?
- отлично подходит для хранения и обработки в реальном времени огромных объемов данных;
- обладает возможностью горизонтально масштабировать продюсеров, консьюмеров и брокеров;
- развитая экосистема Kafka Connect позволяет связывать практически любые источники данных с Kafka в считанные минуты, а Kafka Streams дает возможность проводить обработку этих данных в реальном времени.

## Как используют Apache Kafka?
Kafka используется, когда речь заходит об обработке больших объемов данных в реальном времени, а также производительности и сохранности данных. 

## Примеры использования технологии:
- брокер сообщений для межсервисного взаимодействия;
- обработка кликстрим действий пользователей;
- система очередей (имейте в виду, что Кафка поддерживает только семантику топиков);
- журналирование;
- сбор метрик;
- commit log;
- центральное хранилище информации.

## Основные тезисы:
- Apache Kafka – быстрая, надежная технология для обработки и хранения больших потоков данных с богатой экосистемой и активным комьюнити;
- Kafka не заточена под единственный вариант использования и подходит под разнообразные задачи;
- Kafka - лидирующая технология в своей отрасли, которую уже взяли “на вооружение” более 80% компаний из списка Fortune 100.
- Количество компаний, использующих Kafka во всем мире, продолжает расти и им нужны специалисты.

## В чем отличие Kafka в сравнении с сервисами очередей?
Как и сервисы очередей, Kafka условно состоит из трех базовых компонентов: сервера (брокера), продюсера и консьюмера.  
Главное отличие Kafka от сервисов очередей (например RabbitMQ или Amazon SQS) заключается в том, как сообщения **хранятся** на брокере, а также **потребляются** консьюмерами:
- сообщения в Kafka не удаляются по мере их обработки консьюмерами;
- одни и те же сообщения могут быть обработаны сколько угодно раз, в том числе несколькими сервисами одновременно.

## Внутренняя структура данных Kafka состоит из:
- Event (сообщение), который включает в себя: ключ (key), значение (value), timestamp и опциональный набор метаданных (headers);
- Topics (топики), в которых организованы и хранятся сообщения. В свою очередь каждый Topic состоит из одной или более партиций;
- Partitions (партиции) - это распределенный отказоустойчивый лог (Log). Сообщения с одинаковыми ключами записываются в одну и ту же партицию.
- У каждой партиции есть один брокер лидер - Leader (принимает сообщения от Producer и в общем случае отдает сообщения консьюмеру), 
- Фолловеры (Follower) являются брокерами, которые хранят реплику всех данных партиции и осуществляют запросы лидеру.

## Consumer Groups:
- партиции внутри одной группы назначаются консьюмерам уникально;
- партиции — это основной инструмент масштабирования;
- если консьюмеры не справляются с объемом данных, то необходимо добавить новые партиции в топик и добавить консюмеров в группу;
- важно помнить о гарантии очередности данных, а также то, что партиции невозможно удалить после их создания - придется удалять весь топик целиком.

## Что такое Apache Zookeeper?
Zookeeper - один из важных компонентов кластера Kafka, который выполняет роль консистентного хранилища метаданных.  
В настоящее время Zookeeper является критической зависимостью для Kafka, поскольку именно он способен сказать, живы ли брокеры, какой из брокеров является контроллером, а также в каком состоянии находятся лидеры партиций и их реплики.  
Важно помнить, что падение Zookeeper равнозначно падению всего кластера Kafka! Поэтому эта система также нуждается в поддержке и обновлении.  
Но, к счастью, нагрузка на Zookeeper при нормальной работе кластера является минимальной.

## Полезные ссылки
- [Архитектор Mail.ru: Выбираем правильно очередь сообщений](https://www.youtube.com/watch?v=E0LawhmiSDs)
